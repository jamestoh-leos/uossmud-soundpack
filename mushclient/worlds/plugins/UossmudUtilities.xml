<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, November 05, 2016, 2:44 PM -->
<!-- MuClient version 5.01 -->

<!-- Plugin "UossmudUtilities" generated by Plugin Wizard -->

<muclient>
<plugin
   name="UossmudUtilities"
   author="Victorious"
   id="738b2b1a2b7d6b59e670f943"
   language="Lua"
   purpose="Utilities for uossmud"
   save_state="y"
   date_written="2016-11-05 14:43:11"
   requires="4.75"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   script="onPrompt"
   enabled="y"
   regexp="y"
   match="^(?U)Prompt: hp: (?P<currentHP>[-0-9]+)/(?P<maxHP>[0-9]+) sp: (?P<currentSP>[-0-9]+)/(?P<maxSP>[0-9]+) xp: (?P<xp>[-0-9]+) tnl: (?P<tnl>[0-9]+) target: (?P<target>.+) \(hp: (?P<targetCondition>N/A|[0-9]+)/10 (?P<targetLongCondition>.+)\) buffs: (?P<buffs>.+) debuffs: (?P<debuffs>.+)$"
   omit_from_log="y"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send></send>
  </trigger>
</triggers>

<aliases>
  <alias
   match="hp"
   enabled="y"
   send_to="12"
   ignore_case="y"
   sequence="2"
  >
  <send>printNextPrompt = true
	Send("hp")
</send>
  </alias>

  <alias
   match="^(h|m|c)$"
   regexp="y"
   omit_from_command_history="y"
   omit_from_log="y"
   enabled="y"
   send_to="12"
   ignore_case="y"
   sequence="2"
  >
  <send>
if "%1" == "h" then
	ttsInterrupt("HP: "..hp.."/"..maxHP)
elseif "%1" == "m" then
	ttsInterrupt("SP: "..sp.."/"..maxSP)
else
	if isInCombat then
		ttsInterrupt(target.longCondition.." ("..target.condition.."/10)")
	else
				ttsInterrupt("You are currently not in combat.")
	end
end
</send>
  </alias>

</aliases>

<!--  Script  -->
<script>
<![CDATA[
PPI = require("ppi")
ppi = nil
dir = GetInfo(60).."/uossmud/"
soundDir = dir.."sounds/"
volume = 10

printNextPrompt = false -- temporary ungag
isInCombat = false
target = { name = "None", condition = nil, longCondition = "N/A" }
hp = 0
maxHP = 0
sp = 0
maxSP = 0

function OnPluginInstall()
	ppi = PPI.Load("aedf0cb0be5bf045860d54b7")
	assert(ppi)
end

function onPrompt(name, line, wildcards)
	if printNextPrompt then
		print(wildcards[0])
		printNextPrompt = false
	end
	
	Execute("prompthelper "..wildcards.currentHP.." "..wildcards.maxHP.." "..wildcards.currentSP.." "..wildcards.maxSP.." 100 100")
	hp = tonumber(wildcards.currentHP)
	maxHP = tonumber(wildcards.maxHP)
	sp = tonumber(wildcards.currentSP)
	maxSP = tonumber(wildcards.maxSP)
	local isEnteringCombat = false
	local isLeavingCombat = false
	if isInCombat == false and wildcards.targetCondition ~= "N/A" then
		isEnteringCombat = true
	elseif isInCombat and wildcards.targetCondition == "N/A" then
		isLeavingCombat = true
	end
	local prevTargetCondition = target.condition
	isInCombat = wildcards.targetCondition ~= "N/A"
	target.name = wildcards.target
	target.longCondition = wildcards.targetLongCondition
	if wildcards.targetCondition == "N/A" then
		target.condition = nil
	else
		target.condition = tonumber(wildcards.targetCondition)
		assert(target.condition)
	end
	if isEnteringCombat then
		onEnterCombat()
	elseif isLeavingCombat then
		onLeaveCombat()
	end
	
	if isInCombat and prevTargetCondition ~= target.condition then
		print(target.longCondition)
	end
end

function onEnterCombat()
end

function onLeaveCombat()
end

-- speak text, interupting tts
function ttsInterrupt(text)
	Execute("tts_interrupt "..text)
end

]]>
</script>
</muclient>
