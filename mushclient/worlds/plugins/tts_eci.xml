<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, December 21, 2009, 9:45 AM -->
<!-- MuClient version 4.44 -->

<!-- Plugin "tts_eci" generated by Plugin Wizard -->

<muclient>
<plugin
   name="tts_eci"
   author="Oriol Gomez"
   id="3763b84e35c89d35aadf8d49"
   language="Python"
   purpose="provides speech using the eloquence library."
   save_state="y"
   date_written="2009-12-21 09:44:45"
   requires="4.41"
   version="1.0"
   >

</plugin>

<!--  Aliases  -->

<aliases>
  <alias
   match="tts_stop"
   enabled="y"
   send_to="12"
   sequence="100"
  >
<send>s.stop()</send>
  </alias>
  <alias
   match="eci lang"
   enabled="y"
send_to="12"
   sequence="100"
  >
<send>if (world.GetVariable("eci_lang") is not None):
	s.addText("You can change the english dialect used by typing eci lang gb or eci lang us.")
else:
	s.addText("Language is undefined, you can change the english dialect used by typing eci lang gb or eci lang us.")

s.synthesize()
</send>
</alias>
  <alias
   match="eci rate"
   enabled="y"
send_to="12"
   sequence="100"
  >
<send>if (world.GetVariable("eci_rate") is not None):
	s.addText("rate is currently set to "+str(world.GetVariable("eci_rate")))
else:
	s.addText("Rate is undefined, please set it using eci rate and a number between 50 and 150.")
s.synthesize()
</send>
  </alias>
  <alias
   match="eci lang *"
   enabled="y"
send_to="12"
   sequence="100"
  >
<send>if ("%1"=="gb"):
	world.SetVariable("eci_lang","65537")
	s.setParam(eloquence.eciLanguageDialect, int(world.GetVariable("eci_lang")))
	s.addText("Language set to british english")
	s.synthesize()
if ("%1"=="us"):
	world.SetVariable("eci_lang","65536")
	s.setParam(eloquence.eciLanguageDialect, int(world.GetVariable("eci_lang")))
	s.addText("Language set to american english")
	s.synthesize()</send>
  </alias>

  <alias
   match="eci rate *"
   enabled="y"
send_to="12"
   sequence="100"
  >
<send>world.SetVariable("eci_rate","%1")
s.setVoiceParam(0, eloquence.eciSpeed, int(world.GetVariable("eci_rate")))
s.addText("New rate set to "+str(world.GetVariable("eci_rate")))
s.synthesize()</send>
  </alias>

  <alias
   match="tts_interrupt *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>s.stop()
s.addText("`pp0 %1")
s.synthesize()</send>
  </alias>
  <alias
   match="ecitest *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>s.addText("`pp0 %1")
s.synthesize()</send>
  </alias>

  <alias
   match="eci_msg *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>s.addText("`pp0 `vb59 %1 `vb65")
s.synthesize()</send>
  </alias>

<alias
   match="tts_note *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>s.addText("`pp0 %1")
s.synthesize()</send>
  </alias>

  <alias
   script="TTSToggle"
   match="tts"
   enabled="y"
   group="TTS"
   omit_from_command_history="y"
   omit_from_log="y"
   omit_from_output="y"
   sequence="100"
  >
  </alias>
  <alias
   script="enter_interrupt"
   match="enterinterrupt"
   enabled="y"
   group="TTS"
   omit_from_command_history="y"
   omit_from_log="y"
   omit_from_output="y"
   sequence="100"
  >
  </alias>

</aliases>
<!--  Get our standard constants -->

<include name="constants.pys"/>

<!--  Script  -->

<script>
<![CDATA[
world.Accelerator("ctrl+backspace", "tts_stop")
world.Accelerator("ctrl+shift+enter", "enterinterrupt")

import re
import string
TTSReadNew = 1
EnterInterrupt = 1

pause_re = re.compile(r'([.(),:!?])( |$)')
import eloquence
s=eloquence.Synth()
def OnPluginCommandEntered(st):
	if (EnterInterrupt==1):
		s.stop()
	return st
def enter_interrupt(name, line, x):
	global EnterInterrupt
	if (EnterInterrupt == 1):
		EnterInterrupt = 0
		s.stop()
		world.Execute("eci_msg interrupt on enter turned off.")
	else:
		EnterInterrupt = 1
		s.stop()
		world.Execute("eci_msg interrupt on enter turned on.")
def TTSToggle(name, line, x):
	global TTSReadNew
	if TTSReadNew == 1:
		TTSReadNew = 0
		s.stop()
		world.Execute("eci_msg incoming text will not be read.")
	else:
		TTSReadNew = 1
		s.stop()
		world.Execute("eci_msg incoming text will now be read.")

def OnPluginInstall():
	s.setParam(eloquence.eciDictionary, 1)
	s.setParam(eloquence.eciInputType, 1)
	s.setParam(eloquence.eciSynthMode, 1)
	if (world.GetVariable("eci_rate") is not None):
		s.setVoiceParam(0, eloquence.eciSpeed, int(world.GetVariable("eci_rate")))
	if (world.GetVariable("eci_lang") is not None):
		s.setParam(eloquence.eciLanguageDialect, int(world.GetVariable("eci_lang")))
	world.Execute("eci_msg Speech engine ready. press control plus backspace to stop speech")


def OnPluginScreendraw (t,l,line):
	if TTSReadNew:
		text = pause_re.sub(r' `p1\1\2', line)
		text=string.replace(text,")"," ")
		text=string.replace(text,"("," ")
		text=string.replace(text,">"," ")
		text=string.replace(text,"%10"," ")
		text=string.replace(text,"%13"," ")
		text=string.replace(text,"%10"," ")
		s.addText("`pp0 "+str(text)+".")
		s.synthesize()
	return 0
def onPluginTabComplete(st):
	s.addText(st)
]]>
</script>

</muclient>